/**
 * html2canvas Loader
 *
 * Ce fichier charge html2canvas depuis un CDN.
 * Pour une installation hors-ligne, téléchargez le fichier complet depuis :
 * https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js
 *
 * @version 1.4.1
 * @license MIT
 */
(function() {
    'use strict';

    // Si html2canvas est déjà chargé, ne rien faire
    if (typeof window.html2canvas === 'function') {
        return;
    }

    // URLs des CDN (fallback)
    var cdnUrls = [
        'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js',
        'https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.min.js',
        'https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js'
    ];

    var currentIndex = 0;
    var maxRetries = cdnUrls.length;

    function loadScript(url, onSuccess, onError) {
        var script = document.createElement('script');
        script.type = 'text/javascript';
        script.async = true;
        script.src = url;

        script.onload = function() {
            if (typeof window.html2canvas === 'function') {
                console.log('[Blazing Feedback] html2canvas chargé depuis ' + url);
                if (onSuccess) onSuccess();
            } else {
                if (onError) onError();
            }
        };

        script.onerror = function() {
            console.warn('[Blazing Feedback] Échec du chargement depuis ' + url);
            if (onError) onError();
        };

        document.head.appendChild(script);
    }

    function tryLoadNext() {
        if (currentIndex >= maxRetries) {
            console.error('[Blazing Feedback] Impossible de charger html2canvas. Les captures d\'écran seront désactivées.');
            // Créer une fonction fallback
            window.html2canvas = function() {
                return Promise.reject(new Error('html2canvas non disponible'));
            };
            return;
        }

        loadScript(cdnUrls[currentIndex], null, function() {
            currentIndex++;
            tryLoadNext();
        });
    }

    // Démarrer le chargement
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', tryLoadNext);
    } else {
        tryLoadNext();
    }
})();
